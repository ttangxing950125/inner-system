<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deloitte.additional.recording.mapper.PrsQualDataMapper">


    <select id="findExcelListByCode" resultType="com.deloitte.additional.recording.dto.PrsQualDataExcelDto">
        SELECT en.entity_name AS entityName,
               en.credit_code AS creditCode,
               qd.qual_value  AS qualValue,
               qd.task_status AS taskStatus,
               su.`name`      AS userName
        FROM prs_qual_data qd
                 LEFT JOIN entity_info en ON en.entity_code = qd.entity_code
                 LEFT JOIN sys_user su ON su.id = qd.assign_user
        WHERE qd.qual_code = #{code}

    </select>

    <select id="countLose" resultType="long">

        SELECT count(entity_code)
        FROM prs_qual_data qd
        WHERE qual_code = #{qualCode}
          AND time_value = #{dataYear}
          AND (qual_value IS NULL OR qual_value = '-999999.9999')
    </select>
</mapper>